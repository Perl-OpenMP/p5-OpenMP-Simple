name: Perl CI with Inline::C and OpenMP

on: [push, pull_request]

jobs:
  test:
    strategy:
      matrix:
        os: [ubuntu-latest, debian-latest]  # Updated to include latest Debian
        perl: [system]  # Use the Perl that comes pre-installed
    runs-on: ${{ matrix.os }}
  
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Install Build Essentials (Ubuntu/Debian)
        if: runner.os == 'Linux' && (contains(matrix.os, 'ubuntu') || contains(matrix.os, 'debian'))
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential libgomp1 cpanminus

      - name: Install and Test Perl Modules
        run: |
          cpanm --verbose --notest Inline::C Dist::Zilla Alien::OpenMP  # Install first without tests
          cpanm --verbose --force --test-only Inline::C Dist::Zilla Alien::OpenMP  # Run tests separately

      - name: Run `dzil test`
        run: |
          dzil test
